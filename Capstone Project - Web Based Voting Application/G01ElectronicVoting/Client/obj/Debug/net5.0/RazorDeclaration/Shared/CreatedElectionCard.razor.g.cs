// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace G01ElectronicVoting.Client.Shared
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using G01ElectronicVoting.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using G01ElectronicVoting.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using System.ComponentModel.DataAnnotations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using System.Diagnostics;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\_Imports.razor"
using Google.Cloud.Firestore;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\Shared\CreatedElectionCard.razor"
using G01ElectronicVoting.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\Shared\CreatedElectionCard.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
    public partial class CreatedElectionCard : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 71 "C:\Users\kodyw\csse4770_sp2021_g01\G01ElectronicVoting\Client\Shared\CreatedElectionCard.razor"
 
    [Parameter]
    public Election ThisElection { get; set; }
    [Parameter]
    public EventCallback RefreshElections { get; set; }

    private string SubmitMessage { get; set; } = "";

    public class VoterAddressValidator : ValidationAttribute
    {
        protected override ValidationResult IsValid(object value, ValidationContext validationContext)
        {
            try
            {
                return Regex.Match(value.ToString(), @"^\S+@\S+\.\S+$").Success ? ValidationResult.Success : new ValidationResult("Invalid email address");
            }
            catch (RegexMatchTimeoutException _)
            {
                return new ValidationResult("Timeout");
            }
            catch (Exception _)
            {
                throw;
            }
        }
    }

    public class AddVoterFormModel
    {
        [Required]
        [VoterAddressValidator()]
        public string Voter { get; set; }

        public bool EmailNewVoter { get; set; } = false;
    }

    private AddVoterFormModel model = new();

    private bool loading = false;

    private bool Collapse { get; set; } = true;
    private void ToggleCollapse() => Collapse = !Collapse;

    private (string, string) BadgeStatus(DateTime start, DateTime end)
    {
        if (DateTime.Now < start) return ("badge-primary", "Upcoming");
        else if (DateTime.Now > end) return ("badge-secondary", "Concluded");
        else return ("badge-success", "Active");
    }

    private async Task HideElection()
    {
        ThisElection.Hidden = true;
        await http.PutAsJsonAsync("api/Election", ThisElection);
        await RefreshElections.InvokeAsync();
    }

    private async Task DeleteElection()
    {
        Collapse = true;
        await http.DeleteAsync($"api/Election/{ThisElection.Id}");
        await RefreshElections.InvokeAsync();
    }

    private async Task HandleValidSubmit()
    {
        SubmitMessage = "";
        loading = true;

        if (ThisElection.Electorate.Contains(model.Voter))
        {
            SubmitMessage = "Voter with specified address already in electorate";
        }
        else
        {
            ThisElection.Electorate.Add(model.Voter);
            await http.PutAsJsonAsync("api/Election", ThisElection);

            if (model.EmailNewVoter)
                await http.GetFromJsonAsync<bool>($"api/Email/{model.Voter}");

            SubmitMessage = $"Added {model.Voter} to electorate";
        }

        loading = false;
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient http { get; set; }
    }
}
#pragma warning restore 1591
